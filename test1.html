<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript" src="gl-matrix-min.js"></script>

	<script type="x-shader/x-fragment" id="shader-fs">
		precision medium float;
		varying vec4 vColor;
		void main(void){
			gl_FragColor = vColor;
		}
	</script>

	<script type="x-shader/x-vertex" id="shader-fs">
		attribute vec3 aVertexPosition;
		attribute vec3 aVertexColor;
		uniform mat4 uMVMatrix;
		uniform mat4 uPMatrix;
		varying vec4 vColor;
		void main(void){
			gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
			vColor = aVertexColor;
		}
	</script>

	<script type="text/javascript">
		var gl
		function initGL(canvas){
			try{
				gl = canvas.getContext('webgl')
				gl.viewportWidth = canvas.width
				gl.viewportHeight = canvas.height
			}
			catch (error){
				if (!gl){
					alert('no')
				}
			}
		}
		function getShader(gl, id){
			var shaderScript = document.getElementById(id)
			if (!shaderScript){
				return null
			}
			var str = ''
			var k = shaderScript.firstChild
			while(k){
				if(k.nodeType == 3){
					str += k.textContent
				}
				k = k.nextSibling
			}
			var shader 
			if (shaderScript.type == 'x-shader/x-fragment'){
				shader = gl.createShader(gl.FRAGMENT_SHADER)
			}else if (shaderScript.type == 'x-shader/x-vertex'){
				shader = gl.createShader(gl.VERTEX_SHADER)
			}else{
				return null
			}
			gl.shaderSource(shader, str)
			gl.compileShader(shader)
			if(!gl.getShaderParameter(shader, gl.COMPILE_STATUS)){
				alert(gl.getShaderInfoLog(shader))
				return null
				}
			return shader
			}
			var shaderProgram
			function initShader(){
				var vertexShader = getShader(gl, 'shader-vs')
				var fragmentShader = getShader(gl, 'shader-fs')
				shaderProgram = gl.createProgram()
				gl.attachShader(shaderProgram, fragmentShader)
				gl.attachShader(shaderProgram, vertexShader)
				gl.linkProgram(shaderProgram)
				if(!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)){
					alert('noooo')
				}
				gl.useProgram(shaderProgram)
				shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, 'aVertexPosition')
				gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute)
				shaderProgram.vertexColorAttribute = gl.getAttribLocation(shaderProgram, 'aVertexColor')
				gl.enableVertexAttribArray(shaderProgram.vertexColorAttribute)
				shaderProgram.pMatrixUniform = gl.getUniformLocation(shaderProgram, 'uPMatrix')
				shaderProgram.mvMatrixUniform = gl.getUniformLocation(shaderProgram, 'uMVMatrix')
			}
			var mvMatrix = mat4.create()
			var mvMatrixStack = []
			var pMatrix = mat4.create()
			function mvPushMatrix(){
				var duplicate = mat.create()
				mat4.copy(duplicate, mvMatrix)
				mvMatrixStack.push(duplicate)
			}
			function mvPopMatrix(){
				if (mvMatrixStack.length == 0){
					throw 'kosonggg'
				}
				mvMatrix = mvMatrixStack.pop()
			}
			function setMatrixUniform(){
				gl.uniformMatrix4fv(shaderProgram.pMatrixUniform, false, pMatrix)
				gl.uniformMatrix4fv(shaderProgram.mvMatrixUniform, false, mvMatrix)
			}
			//bikin objek
			var triangleVertexPositionBuffer
			var triangleVertexColorBuffer

			var squareVertexPositionBuffer
			var squareVertexColorBuffer
			function initBuffers(){
				//posisi segitiga
				triangleVertexPositionBuffer = gl.createBuffer()
				gl.bindBuffer(gl.ARRAY_BUFFER, triangleVertexPositionBuffer)

				var vertices = [
					0.0, 1.0, 0.0,
					-1.0, -1.0, 0.0,
					1.0, -1.0, 0.0
				]
				gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW)
				triangleVertexPositionBuffer.itemsize = 3
				triangleVertexPositionBuffer.numItems = 3

				//color
				triangleVertexColorBuffer = gl.createBuffer()
				gl.bindBuffer(gl.ARRAY_BUFFER, triangleVertexColorBuffer)

				var vertices = [
					1.0, 0.0, 0.0, 1.0,
					0.0, 1.0, 0.0, 1.0,
					0.0, 0.0, 1.0, 1.0
				]
				gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW)
				triangleVertexPositionBuffer.itemsize = 3
				triangleVertexPositionBuffer.numItems = 3

				//posisi kotak
				squareVertexPositionBuffer = gl.createBuffer()
				gl.bindBuffer(gl.ARRAY_BUFFER, squareVertexPositionBuffer)

				var vertices = [
					1.0, 1.0, 0.0,
					-1.0, 1.0, 0.0,
					1.0, -1.0, 0.0,
					-1.0, -1.0, 0.0
				]
				gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW)
				squareVertexPositionBuffer.itemsize = 3
				squareVertexPositionBuffer.numItems = 3

				//square color
				squar4VertexColorBuffer = gl.createBuffer()4				gl.b4dBuffer(gl.ARRAY_BUFFER, squareVertexColorBuffer4
				colors = []
				for (var i = 0; i < 4; i++){
					colors = colors.concat([0.5, 0.5, 1.0, 1.0])
				}
				gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW)
				squar4VertexColorBuffer.itemsize = 4
				squa4VertexColorBuffer.numItems = 4
			}
			var rTri = 0
			var rSquare = 0
			//ngopas paknya dl aj
			function drawScene(){
				gl.viewport(0, 0, gl.viewportWidth, gl.viewporHeight)
				gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)
				mat4.perspective(pMatrix, glMatrix.toRadian(45), gl.viewportWidth/gl.viewporHeight, 0.1, 100.0)
				mat4.identity(mvMatrix)
				mat4.translate(mvMatrix, mvMatrix, [-1.5, 0.0, -7.0])
				mvPushMatrix()
				mat4.rotate(mvMatrix, mvMatrix, glMatrix.toRadian(rTri), [0.0, 1.0, 0.0])
				gl.bindBuffer(gl.ARRAY_BUFFER, triangleVertexPositionBuffer)
				gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, triangleVertexPositionBuffer.itemSize, gl.FLOAT, false, 0, 0)
				gl.bindBuffer(gl.ARRAY_BUFFER, triangleVertexColorBuffer)
				gl.vertexAttribPointer(shaderProgram.vertexColorAttribute, triangleVertexColorBuffer.itemSize, gl.FLOAT, false, 0, 0)
				setMatrixUniform()
				gl.drawArrays(gl.TRIANGLES, 0, triangleVertexPositionBuffer.numItems)
				mvPopMatrix()
				mat4.translate(mvMatrix, mvMatrix, glMatrix.toRadian(rSquare), [1.0, 0.0, 0.0])

			}

		}
	</script>
</head>
<body>

</body>
</html>